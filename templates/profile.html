{% extends "base.html" %} {% block title %}Profile Settings - Log Monitor{%
endblock %} {% block content %}
<div class="container">
	<div class="row justify-content-center">
		<div class="col-md-8 col-lg-6">
			<div class="card">
				<div class="card-header">
					<h3 class="text-center mb-0">
						<i class="fas fa-user-cog me-2"></i>Profile Settings
					</h3>
				</div>
				<div class="card-body">
					{% with messages = get_flashed_messages(with_categories=true) %} {% if
					messages %} {% for category, message in messages %}
					<div
						class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show"
						role="alert"
					>
						{{ message }}
						<button
							type="button"
							class="btn-close"
							data-bs-dismiss="alert"
						></button>
					</div>
					{% endfor %} {% endif %} {% endwith %}

					<!-- Profile Information Update -->
					<div class="mb-5">
						<h5 class="card-title">
							<i class="fas fa-user me-2"></i>Profile Information
						</h5>
						<form method="POST">
							<input type="hidden" name="action" value="update_profile" />
							<div class="mb-3">
								<label for="username" class="form-label">Username</label>
								<input
									type="text"
									class="form-control"
									id="username"
									name="username"
									value="{{ current_user.username }}"
									required
								/>
							</div>
							<div class="mb-3">
								<label for="email" class="form-label">Email</label>
								<input
									type="email"
									class="form-control"
									id="email"
									name="email"
									value="{{ current_user.email or '' }}"
								/>
							</div>
							<div class="d-grid">
								<button type="submit" class="btn btn-primary">
									<i class="fas fa-save me-1"></i>Update Profile
								</button>
							</div>
						</form>
					</div>

					<hr />

					<!-- Password Change -->
					<div class="mb-4">
						<h5 class="card-title">
							<i class="fas fa-lock me-2"></i>Change Password
						</h5>
						<form method="POST">
							<input type="hidden" name="action" value="change_password" />
							<div class="mb-3">
								<label for="current_password" class="form-label"
									>Current Password</label
								>
								<input
									type="password"
									class="form-control"
									id="current_password"
									name="current_password"
									required
								/>
							</div>
							<div class="mb-3">
								<label for="new_password" class="form-label"
									>New Password</label
								>
								<input
									type="password"
									class="form-control"
									id="new_password"
									name="new_password"
									required
									minlength="6"
								/>
								<div class="form-text">
									Password must be at least 6 characters long.
								</div>
							</div>
							<div class="mb-3">
								<label for="confirm_password" class="form-label"
									>Confirm New Password</label
								>
								<input
									type="password"
									class="form-control"
									id="confirm_password"
									name="confirm_password"
									required
								/>
							</div>
							<div class="d-grid">
								<button type="submit" class="btn btn-warning">
									<i class="fas fa-key me-1"></i>Change Password
								</button>
							</div>
						</form>
					</div>

					<hr />

					<!-- Account Information -->
					<div class="mb-4">
						<h5 class="card-title">
							<i class="fas fa-info-circle me-2"></i>Account Information
						</h5>
						<div class="row">
							<div class="col-sm-4">
								<strong>User ID:</strong>
							</div>
							<div class="col-sm-8">{{ current_user.id }}</div>
						</div>
						<div class="row">
							<div class="col-sm-4">
								<strong>Status:</strong>
							</div>
							<div class="col-sm-8">
								<span class="badge bg-success">Active</span>
							</div>
						</div>
					</div>

					<div class="text-center">
						<a href="{{ full_url_for('index') }}" class="btn btn-secondary">
							<i class="fas fa-arrow-left me-1"></i>Back to Dashboard
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %} {% block scripts %}
<script>
	// Password confirmation validation
	document
		.getElementById("confirm_password")
		.addEventListener("input", function () {
			const newPassword = document.getElementById("new_password").value;
			const confirmPassword = this.value;

			if (newPassword !== confirmPassword) {
				this.setCustomValidity("Passwords do not match");
			} else {
				this.setCustomValidity("");
			}
		});

	document
		.getElementById("new_password")
		.addEventListener("input", function () {
			const confirmPassword = document.getElementById("confirm_password");
			if (confirmPassword.value) {
				confirmPassword.dispatchEvent(new Event("input"));
			}
		});
</script>
{% endblock %}
